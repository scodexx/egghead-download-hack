// https://egghead.io/lessons/misc-practical-git-create-local-repos-with-git-init (Practical Git for Everyday Professional Use)
var _input,_status,_select,_code;_status=new templateJs("#egghead-status",{methods:{html:function(e){this.innerHTML=e}}}).build(),_code=new templateJs("#egghead-code",{ready:function(){autosize(this)},bind:{focus:function(){var e=document.getSelection();e.removeAllRanges(),this.select(),document.execCommand("copy"),e.removeAllRanges(),_status.fn.html("Copied!")}},methods:{html:function(e){this.innerHTML=e}}}).build(),_select=new templateJs("#lessons",{data:{lessons:[]},bind:{change:function(e,t){for(var s,n=[],a=(t=0,this.options.length);t<a;t++)!0===(s=this.options[t]).selected&&n.push(s.value);_status.fn.html(""),this.fn.generateMultipleCodes(n)}},methods:{clear:function(){for(i=0;i<this.options.length;i++)this.options[i]=null},setup:function(){this.disabled=!1,this.fn.clear();var e=this.data.lessons;for(var t in e)if(e[t=Number(t)].media_urls){var s=document.createElement("option");s.text=t+1+". "+e[t].title,s.value=e[t].media_urls.dash_url,this.add(s)}},generateMultipleCodes:function(e){var t=[];for(var s in e)t.push(this.fn.getCode(e[s]));_code.fn.html(t.join(" && "))},getCode:function(e){var t=e?"youtube-dl -f bestvideo+bestaudio --merge-output-format mp4 ":"",s=this.data.lessons;for(var n in s)s[n=Number(n)].media_urls&&s[n].media_urls.dash_url===e&&(t+='-o "'+(n+1)+". "+s[n].title+'.mp4" ');return t+=e}}}).build(),_input=new templateJs("#egghead-url",{bind:{change:function(e,t){this.fn.process()}},methods:{process:function(){var e=this.fn.checkInput();if(!e)return this.value="",alert("Invalid egghead lesson url");this.fn.makeRequest(e).then(function(e){_select.data.lessons=e.list.lessons,_select.fn.setup()},function(e){console.log(e)}).catch(function(e){console.log(e)})},makeRequest:function(e){return new Promise(function(t,s){var n="https://egghead.io/api/v1/lessons/"+e+"/next_up",a=new XMLHttpRequest;a.addEventListener("loadstart",function(){_status.fn.html(" Loading..")},!1),a.addEventListener("readystatechange",function(e){var s,n;_status.fn.html("");try{n=e.target.readyState,e.target.responseText,s=e.target.status}catch(e){return}4==n&&"200"==s&&e.target.responseText&&t(JSON.parse(e.target.responseText))},!1),a.open("GET",n,!0),a.send()})},checkInput:function(){var e=this.value.trim(),t="/lessons/";if(e.match(t)!=t)return!1;var s,n=(s=e.slice(e.lastIndexOf(t)+t.length).trim()).lastIndexOf("/")<0?s.length:s.lastIndexOf("/");return""!=(s=s.slice(0,n))&&s}}}).build();